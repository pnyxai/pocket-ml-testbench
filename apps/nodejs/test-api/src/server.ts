import cors from 'cors'
import express from 'express'

const app = express()

const port = 3001

function randomIntFromInterval(min: number, max: number) { // min and max included
  return Math.floor(Math.random() * (max - min + 1) + min)
}

const nodes = [
  '02e7b1b0ac4eb4b3f46e05ae4dedc457a7c5d7b5',
  'd4ea928828c8176ab37c9aaa765a03da770b4f34',
  'ddbb63a81a9b2b864e385d3f1e8ba76a0cca506a',
  '6c8ed9e3b5502bb11ccf89a4a6265f0ea4392380',
  '98dadd2644a660f1382f06d6a373edc85aef1696',
  '9a52570e2f70fae0f18a35ff0fce428b3099d79b',
  '5c9f7bad0c7498e44522e412e0e754509e9369a7',
  '7b9d51f0e2680802844e21612baeebae31ee2645',
  'eb383f65154375096e357d7946260ea30fbfff40',
  '54806cc7b7a70c24e42645ec278968e7a9bd4655',
  '2fd864bec4df63995f4b7a2169790f30384f2850',
  '1ac87113615b58bdf870a221f92513921543c18f',
  '0a7b9c4316f800ca1b4b58c5897b68036b07814b',
  'c380d743c3ccbc42a6f17c6944abcffbf47c4fc1',
  '2189325a17cc673060ba5a71d0e359388e7b9360',
  '871d8c88d84c6c545c26c4a5037ad7ea90b6c755',
  'fa50ab3d6b8567afb27242bdbd5099c8a4d40f29',
  '4645b12c90627bf8033dc90d63e06b02c5b170c5',
  '9bd7c9c82474cd4dcc827dc2b252fcc6b75982b1',
  'b29da3ab6dae515507f70531bb7420114746c5b8',
  '617710168225fdbb41bbd15e35e0e736807564e6',
  'ec313c319a5b9dc1bf1229a0244601eee52c3f65',
  'c8db81b853ba7f885f6e1ea1915a5303b5a39cd3',
  '9635c0fafb6fb13c9354c8d04b62bcd8e684b900',
  'ae0e978dd8e7c9cf1e20c6ecb9b972d455b0cd8c',
  '0a9bb273e006fc2162853faa66b4f66a219407a8',
  '303c8e87543a6c4d3eb24c155977060e07f44091',
  '89058e989fe3e0c0020f2c4621a12acb8f1f4145',
  '38a06239794caa0a3cc9b709b2397da1ad25dda5',
  'de3ca9b663fa325cd165f82127e03739b8787de3',
  '80f4d85fcbf0438a5ab3e791c15798e10b5cb74b',
  '2467560a7b6acf0c209ae646972a14a558d7f83b',
  'd4719c5768ae239fc61b7e5ba107d9885eda385c',
  '1ece8b79c1fdfdc3a28f01dfefcc4859680898c2',
  'b62de2d9c1d160e3ffd636a5ba4c762e3c296abc',
  'b08be0b107be5240ec6eee3228a70a31524584f7',
  '622303f97461e9c108fba62375c95b525e50179c',
  'b9550cecb028e35ca538412154066d15050921c5',
  'e67a00ae820b7d188fbaeaafe85538b94ba03282',
  'd403065186771da22a85de662eb30a220071e9b2',
  '475cf7ba4cd316cb655e576e3392798a8f3a5e61',
  'e16d59b925036d5d6e77ba4e9160e3d2abe9c203',
  'c4e683d07df91feef1df5f7eb9ebe7254ffebe1d',
  '7e07ba0eb256ae158b032b3725a5f632742fb1e0',
  '12415b9602340751ec8ae80ba835629de7461bde',
  'fae9a96793e82fe8cb96fef70da003da6b4cdaa0',
  '098c8a3658002f8b9cbc913def831b6b86a79cb5',
  'e2ca65695ad072c8b36dd7bc28b3c763efde3c77',
  '44081a15a2ba8e39a5121133b33041e96b36b908',
  'fc67a827f25444c57de45138379c731c7eabe339',
  '9260662543f7a46490ca51f0c1560b1fafaaf92d',
  '57f1a1a536e9f69ae5f9b883ecf7a14209a654d2',
  '9dda96fdedb0e4373e34d962773c3238f4ad0f20',
  'ba98c2d5d7eadd2b16dd395988569d9b0f84a165',
  '35706f1b431d4638169cbd091c1ed63c37690c66',
  'de8dc9d5da0320fb7ecc18c3440fabb2372b99d4',
  '6fb9743c9c856184622c33ded154a0eea4b0c3dc',
  'c344b7b31dec1b9b966719bcceb19e321a140db6',
  '8d51dd910332640765c2e31261e60d1431ce7577',
  '3a546ad225d1e5c425953e0f59d0406478df02f8',
  '870f6095cb5003c69d0d298823f9506e20fe7ea8',
  '07a1c0aaa4bacace7b66f7d25f48b7b7530c673a',
  '9f0b55da79124c39b639e1340b2fd42dd2d4d602',
  '6f037b217115d265c52e1bfc75035112069f2286',
  '7b97a6d82e5abb8dc55ba45df7a5c50777825b65',
  '7534edd1f284376ef911732c332380f732c5beed',
  '9498fe04d05a87abda396857230be62d2c0d041e',
  '786f4a24c42a00863455e48eb7a0cd0a17d60651',
  '0f757b76db7dae4a01383b9a5d47098cbf423040',
  '10dde3592fd42fe96f0d902b7ace000cfc65d715',
  'd8c52f58631e0d96a8cd67628f95f8b30d21d5e4',
  '0344ac6824eca4ffc76477fef2f97324fdeecee8',
  'ec511da60b4955cbdf1e33ec82afaf7bc6cb42da',
  '456d4d52cd80ea61feb22176ebf44e7821e73488',
  '02ee4255e3133d8eb5a50acedfd9a97aadc63775',
  '633269f3f5a4cb7b6f224527bbeb550f2bc3571b',
  'c5488b55e40e46c73ec9082be899a7dc856ebb73',
  '7cd104ec60832d00ba9f77b4bd9f02b47ad9a8b1',
  'cfad4115aad61a9314d4cd10ba27ad276592f527',
  '0202d34565dc03759a177e90a3e7ba30fa10b231',
  '540a7d4b04cde15294ad00240dc5007e672f86f5',
  '29d1d03796872874676000070338eef6bd2c335a',
  'd6ac8b8534912c29c9b721c9284f709cc1c9bfa5',
  'af81d3709c9ec9169900a6bd2331ca5fe9a078be',
  '02d39755d1129d776977d67656195d43451a18fb',
  'c2258796f7ae68206424860fcf26e4fcf5176271',
  '2768eb6b0105f643af696ea2bbe1a8ad351429c3',
  '5b7a5f30e69cada0c89925b5700ddea41fda3819',
  '7137827eb202488aa881ea871df41703f670372b',
  '739ae1d46234e6c9a32bd0ffd99237e0e88419d9',
  '8fee06edb598a3e26815f0eac181e9eac9bdf68c',
  '74d9f531415e211ba703400a8943d96c1bdf8c4d',
  'fd7b23a7dacc818baf2ebda0219e51b56f04ec24',
  '51e29622564da2e5b1642c6d60925229f9534d62',
  'f07921fb9ef6c6465837a8a0d4c33632eae63f6b',
  'cb8c0204761cb19444c5e464f901a2a62036b361',
  '122080f3230b99695b11d6fb74202417b8cc5b47',
  'c2665e92aaa1804b47831ab4e8a31c50ac984460',
  'c47941a96a61de6a118d78d6b4a9f6dee4a47f1e',
  'b2735933f166a55c48a43243b250b7f7c5f1efb5',
  '2f98d92494ef2884406f3d1d60b6bd93aff1d510',
  '26342e8cd84d0261b06f8a6e46f33e7341a75b09',
  '65e98df40f9e8f31d2c75495c6d399f9e46d04ea',
  '055d4e64b679e5df562f03b3826f6322433fe387',
  'c07bd13946cc81f694c013323d4cd6c306ea3448',
  '583bb9b2f21b2d5b7c895eb4e8617358327f0f17',
  'e40f268f71ac1a3e037f93d643f485e7bfa6375f',
  '351eb2af38b834f835697bce6b2fa0c28adb297a',
  '0f13d44a2b6d828c679cac91507944cceb990bc4',
  '1d796cc3451f7cd97f477c6389378eadf6a5caec',
  '7dbf2bedefd162b3561a1c4f4bb849e15d62ce49',
  'ffbeefb0b364a2f4b25a2ff39f4b6fe2f6595697',
  '18a699a2eb97c088c87002fd74335b905ebc8e62',
  '255ec554996cb452a4d26a29f8d679ee5e4cca1c',
  '87d2a66f634afa49458dd33ff4382885846c6deb',
  'c9701fa99426beade319b9e25e9ff59ab53ae70d',
  '1d4a114d72ba04b9236fc7e2cd8cbf31d20954e9',
  'd0218b2d4a52410aedaa8c23cb9c978c890a3eac',
  'ffad090789253ad0439c56b7b9c301f90424d5b7',
  'ed66e554017becaada3dc879f93d4a953b83251c',
  '98f14154659a44915a73d261995eb42490e9399d',
  'aa8b508aff174dcade3419f5c8a59e33cc811a8f',
  'a906034e2681a6fd4f071ca9ef0d77fb78df02db',
  'aa8d0b71ea02b99d417196cbf72b3eecab049a22',
  '2dbb40298820fe4bc7cd02ade56f612a03402a27',
  'a5fc498e5fe9276c3e2f8b7c850db3bb2423e953',
  'ec79e6a3038930ddffb024143cfde2ba3dcab9fb',
  'ed6a1ec4613e22ecaa45595ec35d5de9198ac9b8',
  'da0df51db18ba0227060bbe0cfb6923ff2725213',
  'db75301ef4ced9cc15e11463d410b286481c3e85',
  'b97a2ad472986f0c02c64d03bf259077fae5b092',
  'bf134a62336bbf27ae1402163fe985f442a68029',
  '4555b614e24cc540c8455b5aaf243360a48d33b8',
  '975932f16dc5d0ffe1dadd26a20460621c1a03d8',
  '58a53da960803a5359d7269b0a58705cf832b35f',
  'bb04bab08f9ce716da5149c009e8ecf6ba0fe71d',
  '8ec1159d7b472f2dda138c58af42f012924a4786',
  'ba136a0a29a78f4538b5f652f79871e9149ade31',
  '77b33bf4d88c2ad2b760b1365505b305c0fbde10',
  'dd7a488a2923432b3307fa59e83972046bd28560',
  'b480488006a56941cd310b34b917bc34a0021414',
  '2ae9b04a2abc0d29b07d918c7ee0dd304afc1633',
  '1797d848cf0b9bffd18599966fe2b9d847865dcf',
  '37dff11e1c9d9eeec3c6d4f8aea63b4ff88c6f65',
  'e78022db6218afe920d4a56baf17c9039ef6f0ec',
  '28f51e4690f739e186d1dcc1f9d9dd8fecd591ae',
  '73690a2c42930ce2875e774cab550b6a70c1fd94',
  'b90ef71c9e901b16684e0017862459ca3008c911',
  '06af77855ec78808505fc2104d8502235709e089',
  'c6e081511322a0a44c628f1725dc57774dcb5a7a',
  '4ef907c1fc1083668ac06b4a62749b7120648001',
  '36a51724c880529838595828c725f21968332408',
  'd851f8ccbdc6e67523c4ffac95e1ec918f81c8fd',
  '585e6bbfa10d6996a7e90a0f50b5afb58e6226ed',
  'd53e843921665f7884a3e822b3b2e1d81986f3ea',
  '29e1431a1cd075a82e2a101720abc91558287c98',
  '51d6b5e97b6804ee8ab22d5b1ab8cf4fb55c96ff',
  '28bdfdaf8cca497ee37102c7b84412266b50e60f',
  '3f4cc59b438353b0adec6cd6923334ec7d10f8f1',
  '5bf0faa9f78d82290be43b9e86aa005625979962',
  'acb7c244c9f31bf7126d4a6d54a302d563905e58',
  'b38fa0fa4d1866d16a7d568ad6c66807096557d7',
  '4a63a7fbc5d912a1b1882c0327aa2fb8cf823532',
  '6061ffba2172c1e9a33829fa947a2bb22d0c1b09',
  'b15c5596f0ca7ff87f5058081297820f4263a197',
  'd7ad0fadb7ab5114f0ffcdd0dd3836d7db30359a',
  '7e02334e5c5cbb027b0aa90e14d9b4c4136e35b5',
  'af233fb474988ee1e061ec396a83cc1e18807fab',
  '4cbb6d9563c9d0ce5b4e2c7842f6715eb2a80579',
  'a2e41dc2bda3e2fd5f835e7f3f38a56199e810f4',
  'e661eb4d733219d27fc8318bc6e82a5c615989c7',
  'a88217dbfd3763de29e5be6e08d654f64dede6cb',
  '6a0a6361b90680a579e0f64487bf43d5096681d7',
  '66036f594f0cb35ee2f4335655111288e673e335',
  'a4471d4f8940045a24d19de10cde91da0bc5c981',
  '18048513acb80601bca1943c9f8072092a23a124',
  '8d581d75d2e0a78e6b1e54e3fc751d3e0ee426f1',
  '4b01030155ba837d25d0fb48b074407808ae72d9',
  'e72e8b13951e8708676589b33f4389ccd0b80d49',
  '6c38b462a34382f8feeaafeded77b31f54591355',
  'ab40965d7e0cb1792642b5d70e86d281674f9122',
  '56cf6e6a07f8ea66be2962161ebd5168fd7fa8d4',
  '19f8fc6d614f411edadec166feed2faeecef93a8',
  '7c40b3d02f0ebd4b121dd85a96f49e41ce91d053',
  'ebf25d7dcf3eb0ed6aabcc9efb7bd1788d568675',
  '4e3f6b73dd209cac8269729d13eb27cd7a983fc8',
  '18b0ae52d7b4b70f3e942057117914d685ddbcaa',
  '7a3fe118b655b639a2f4c1e2fc7dae61966d3bf1',
  '14fbf70ace5ac657f23fa599a4c319200d9f038a',
  '47e2009f80cc7a1ff8136ef7c26c59e00b318f52',
  '60ac5e8c11f1afb51884457151208f67bbcffdb6',
  '5a35c6a6905b014872b36352bea9dc07ed032317',
  '32b7dcac0c62487df20dc5906a0fde1f0147436c',
  '32612f4e3a0cf054ebb89dbc5e2a13daca4d9ba2',
  '8883910b724eca542be79dddfc519edf710a6e36',
  '7d5b56842497630c5554625d77e082f4f39ab262',
  'a35095f75ed96d21cb3d1e1cb7569d4b8280e3c3',
  'e717d877034c61ef41fcdb43756d01d19ce99ffa',
  '3be81b663c19b8afc6da90adb52a0b2e486edee1',
  '5efae737345ca973fc2c01126c023dbf9b3d75c7',
].slice(0, 100)

const values = ['average', 'arc', 'hellaswag', 'mmlu', 'truthfulqa', 'winogrande', 'gsm8k'] as const

type RawData = {
  mean: number
  stderr: number
}

type NodeRawData = {
  qos: {
    response_time: number,
    error_rate: number,
  }
  metrics: Record<typeof values[number], RawData>
}

app.use(cors())

app.get('/', (req, res) => {
  console.log('fetched data')
  const nodesToReturn = nodes.slice(0, randomIntFromInterval(nodes.length * 0.75, nodes.length))

  const data: Record<string, NodeRawData> = {}

  for (const node of nodesToReturn) {
    const dataToPush: Partial<NodeRawData['metrics']> = {}

    for (const key of values) {
      const stderr = randomIntFromInterval(1, 95)
      dataToPush[key] = {
        mean: randomIntFromInterval(50, 95) / 100,
        stderr: stderr > 50 ? stderr / 1000 : 0,
      }
    }

    data[node] = {
      qos: {
        error_rate: randomIntFromInterval(0, 100) / 100,
        response_time: randomIntFromInterval(750, 9000) / 10,
      },
      metrics: dataToPush as NodeRawData['metrics'],
    }
  }


  res.json(data)
})

app.listen(port, () => {
  console.log(`Server is running on http://localhost:${port}`)
})

//{
//   "7c08e2e1265246a66d7d022b163970114dda124e": {
//     qos: {
//       response_time: 352.6,
//       error_rate: 0.02,
//     },
//     metrics: {
//       average: { mean: 0.59, stderr: 0.046 },
//       arc: { mean: 0.59, stderr: 0.046 },
//       hellaswag: { mean: 0.59, stderr: 0.046 },
//       mmlu: { mean: 0.59, stderr: 0.046 },
//       truthfulqa: { mean: 0.59, stderr: 0.046 },
//       winogrande: { mean: 0.59, stderr: 0.046 },
//       gsm8k: { mean: 0.59, stderr: 0.046 },
//     },
//   },
//   e441b6024deb682291abff461bf9cc855f5ae659: {
//     qos: {
//       response_time: 352.6,
//       error_rate: 0.02,
//     },
//     metrics: {
//       average: { mean: 0.59, stderr: 0.046 },
//       arc: { mean: 0.59, stderr: 0.046 },
//       hellaswag: { mean: 0.59, stderr: 0.046 },
//       mmlu: { mean: 0.59, stderr: 0.046 },
//       truthfulqa: { mean: 0.59, stderr: 0.046 },
//       winogrande: { mean: 0.59, stderr: 0.046 },
//       gsm8k: { mean: 0.59, stderr: 0.046 },
//     },
//   },
// }
